<!DOCTYPE html>
<html lang="en">
<head>
    <title>AoC - Day 9 part II</title>
    <script src="../lib/js/resultDisplay.js"></script>
    <link rel="stylesheet" href="../Style/style.css">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet" />
</head>

<body>
    <h1>Advent of Code - Day 9 part II</h1>
    <div id="card">
        <a href="../index.html" class="homeLink">→ Home</a>
        <a href="part1.html" class="homeLink">→ Part I</a>
        <textarea id="input" placeholder="Enter your input here..."></textarea>
        <button class="button" type="button" onclick="strParse()">Test</button>
        <script>
            let result = 0;
            let indexedDisk = [];
            let filesIndex = [];
            let spacesIndex = [];
    
            function newReorder(arr) {
              // Reorder furthest right hand file with furthest left hand space with matching slots
            }
    
            function diskIndexer(arr) {
                let spaceIndex = 0;
                let diskIndex = 0;

                for (let i = 0; i < arr.length; ) {
                    let start = i;
                    let end = i;

                    if (arr[i] === ".") {
                        // Initialize the array if not already
                        if (!spacesIndex[spaceIndex]) spacesIndex[spaceIndex] = [];
                        // It's a space range
                        while (end < arr.length && arr[end] === ".") {
                            end++;
                        }
                        spacesIndex[spaceIndex].push([start, end - 1]);
                        spaceIndex++;
                    } else {
                        diskIndex = parseInt(arr[i]);
                        // Initialize the array if not already
                        if (!filesIndex[diskIndex]) filesIndex[diskIndex] = [];
                        // It's a number range
                        while (end < arr.length && arr[end] !== ".") {
                            end++;
                        }
                        filesIndex[diskIndex].push([start, end - 1]);
                        diskIndex++;
                    }

                    i = end; // Move the index to the next unprocessed element
                }
            }

            async function strParse() {
              result = 0;
    
              const inputSrc = document.getElementById("input").value.trim();
    
              const expectedResult = async () => {
                const url = "https://advent.fly.dev/solve/2024/9/2";
                const headers = {
                  Accept: "text/plain",
                  "Content-Type": "text/plain",
                };
                const data = inputSrc;
    
                try {
                  const response = await fetch(url, {
                    method: "POST",
                    headers: headers,
                    body: data,
                  });
    
                  if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                  }
    
                  return await response.text();
                } catch (error) {
                  console.error("Error:", error.message);
                  return null;
                }
              };
    
              const expectedAnswer = await expectedResult();
    
              let iterator = 0;
    
              let stringToArray = Array.from(inputSrc);
    
              let diskContent = [];
    
              for (let i = 0; i < stringToArray.length; i++) {
                if (i % 2 === 0) {
                  for (let j = 0; j < parseInt(stringToArray[i]); j++) {
                    diskContent.push(iterator.toString());
                  }
                  iterator++;
                } else {
                  for (let j = 0; j < parseInt(stringToArray[i]); j++) {
                    diskContent.push(".");
                  }
                }
              }
    
              // newReorder(diskContent);

              diskIndexer(diskContent);

              console.log(diskContent);
              console.log(filesIndex);
              console.log(spacesIndex);
    
              for (
                let i = 0;
                i < diskContent.length && diskContent[i] !== ".";
                i++
              ) {
                result += i * parseInt(diskContent[i]);
              }
    
              if (result != expectedAnswer) {
                resultDisplay(
                  "Your result is incorrect (" +
                    result +
                    "). The correct answer was " +
                    expectedAnswer +
                    "\n\n" +
                    JSON.stringify(
                      {
                        result: result,
                        expected_result: expectedAnswer,
                        delta: Math.abs(result - expectedAnswer),
                      },
                      null,
                      2
                    )
                );
              } else {
                resultDisplay(result);
              }
            }
          </script>
        <div id="resultDisplay">
            <!-- Result display -->
        </div>
    </div>
</body>
</html>